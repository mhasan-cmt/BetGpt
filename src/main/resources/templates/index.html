<!doctype html>
<html class="h-full bg-gray-100" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Generated by tailwindcss CLI -->
  <link th:href="@{/css/global.min.css}" rel="stylesheet">
  <script th:src="@{/js/components/chatty-modal.js}" type="module"></script>
  <script th:src="@{/js/components/chatty-prompt.js}" type="module"></script>
  <script th:src="@{/js/components/chatty-prompt.js}" type="module"></script>
  <script th:src="@{/views/left-menu.js}" type="module"></script>
  <script th:src="@{/views/settings-view.js}" type="module"></script>
  <script th:src="@{/views/create-chat.js}" type="module"></script>
  <script th:src="@{/views/chat-view.js}" type="module"></script>

  <script src="https://code.jquery.com/jquery-3.6.4.js"
  integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E="
  crossorigin="anonymous"></script>
</head>

<body class="h-full">
  <input id="beforeDanSetting" type="hidden" value="0">
  <!-- Page Container -->

  <div class="h-full">

    <!--<left-menu></left-menu>

    <div class="flex flex-1 flex-col pl-64 h-full">-->
    <div class="flex flex-1 flex-col h-full">
      <main class="flex-1 h-full">
        <div id="main-content" class="relative h-full overflow-x-hidden overflow-y-auto">

          <!-- content -->

          <create-chat class="create-chat"></create-chat>

        </div>
      </main>
    </div>
  </div>

  <chatty-modal id="settings-modal">
    <settings-view></settings-view>
  </chatty-modal>

  <chatty-prompt id="clear-all-prompt">
  </chatty-prompt>
  <script>
    // TODO: Much of this, should be packed into something like a "router".
    // The router should also take care of removing current content and injecting the new view. 
    // A router should also parse and use the URL parameters.

    // Left menu listeners
/*
    document.querySelector('left-menu').addEventListener('settings', (evt) => {
      evt.preventDefault()
      evt.stopPropagation()

      document.querySelector('#settings-modal').setAttribute('visible', true)
    })

    document.querySelector('left-menu').addEventListener('clear', (evt) => {
      evt.preventDefault()
      evt.stopPropagation()

      document.querySelector('#clear-all-prompt').setAttribute('visible', true)
    })

    document.querySelector('left-menu').addEventListener('create-chat', (evt) => {
      evt.preventDefault()
      evt.stopPropagation()

      document.querySelector('#main-content').innerHTML = '<create-chat />'
    })

    document.querySelector('left-menu').addEventListener('chat', (evt) => {
      evt.preventDefault()
      evt.stopPropagation()

      document.querySelector('#main-content').innerHTML = `<chat-view chat-id="${evt.detail}" />`
    })
*/

    // document.querySelector('left-menu').addEventListener('click', (evt) => {
    //   console.log(evt)
    // })

    // Settings and clear listeners

    // Show the settings modal, when no API key has been set
    if (!localStorage.getItem('openai-apikey')) {
      //document.querySelector('#settings-modal').setAttribute('visible', true)
      document.querySelector('#settings-modal').setAttribute('visible', false)
    }

    // Close the modal, when done event is received
    document.querySelector('settings-view').addEventListener('done', (evt) => {
      document.querySelector('#settings-modal').setAttribute('visible', false)
      document.querySelector('left-menu').update()
    })

    // Clear localStorage, update settings view and hide the prompt 
    document.querySelector('chatty-prompt').addEventListener('ok', (evt) => {
      evt.preventDefault()
      evt.stopPropagation()

      localStorage.clear()

      document.querySelector('settings-view').updateView()

      document.querySelector('chatty-prompt').setAttribute('visible', false)
    })

    // "Create chat" listener

    document.querySelector('#main-content').addEventListener('created', (evt) => {
      //document.querySelector('left-menu').update()
      document.querySelector('#main-content').innerHTML = `<chat-view chat-id="${evt.detail}" />`
    })

    // Listen for any bubbled update-menu events on main-content
    document.querySelector('#main-content').addEventListener('update-menu', (evt) => {
      document.querySelector('left-menu').update()
    })
    $(document).ready(function(){
      setTimeout(function(){}, 2000);
      $("#user").css("display","none");
      var userText = "Welcome to betGPT beta version";
      $("#user").attr("value",userText);
      var sr = document.querySelector("create-chat").shadowRoot;
      var srDiv = sr.querySelector("div");
      var srForm = srDiv.querySelector("form");
      var srUser = srForm.querySelector("#user");
      $(srUser).val(userText);
      var createChatBtn = $(srForm).find("#create-chat");
      $(createChatBtn).trigger("click");
    });
  </script>
</body>

</html>